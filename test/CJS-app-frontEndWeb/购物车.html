<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="utf-8">
    <title>购物车</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <script type="text/javascript" src="./js/adaptive.js"></script>
	<link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/weui.min.css">
    <link rel="stylesheet" href="./css/all.css">
    <link rel="stylesheet" href="./css/home.css">
</head>
<body>
    <div class="container">
        <div class="shop-group">
            <div class="shop-group-item">
                <div class="shop-title">
                    <div class="check-wrapper">
                        <span class="cart-checkbox shop-checked"></span>
                    </div>
                    <div class="shop-title-content">
                        <span class="shop-title-name">张兴力的店铺</span>
                        <a class="shop-btn-com get-coupons" href="#">领取优惠券</a>
                    </div>
                </div>
                <ul>
                    <li>
                        <div class="items">
                            <div class="check-wrapper">
                                <span class="cart-checkbox prod-checked"></span>
                            </div>
                            <div class="shop-cart-item-core clearfix">
                                <a href="#">
                                   <img> 
                                </a>
                                <div class="cart-product-cell">
                                    <div class="cart-product-name">
                                        <a href="#">
                                            <span class="title">八马茶业 铁观音茶叶 清香特级 安溪乌龙茶 安溪铁观音 礼盒 250g</span>
                                        </a>
                                    </div>
                                    <div class="cart-product-cell-1">
                                        <span class="shp-cart-item-price">¥15.00</span>
                                        <div class="quantity-wrapper">
                                            <a href="#" class="quantity-decrease">-</a>
                                            <input type="tel" size="4" value="1" name="num" class="quantity">
                                            <a href="#" class="quantity-increase">+</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="del-box"><span>删除</span></div>
                        </div>
                    </li>
                    <li>
                        <div class="items">
                            <div class="check-wrapper">
                                <span class="cart-checkbox prod-checked"></span>
                            </div>
                            <div class="shop-cart-item-core clearfix">
                                <a href="#">
                                   <img> 
                                </a>
                                <div class="cart-product-cell">
                                    <div class="cart-product-name">
                                        <a href="#">
                                            <span class="title">八马茶业 铁观音茶叶 清香特级 安溪乌龙茶 安溪铁观音 礼盒 250g</span>
                                        </a>
                                    </div>
                                    <div class="cart-product-cell-1">
                                        <span class="shp-cart-item-price">¥16.00</span>
                                        <div class="quantity-wrapper">
                                            <a href="#" class="quantity-decrease">-</a>
                                            <input type="tel" size="4" value="1" name="num" class="quantity">
                                            <a href="#" class="quantity-increase">+</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="del-box"><span>删除</span></div>
                        </div>
                    </li>
                </ul>
            </div>
            
            <div class="shop-group-item">
                <div class="shop-title">
                    <div class="check-wrapper">
                        <span class="cart-checkbox shop-checked"></span>
                    </div>
                    <div class="shop-title-content">
                        <span class="shop-title-name">张兴力的店铺</span>
                        <a class="shop-btn-com get-coupons" href="#">领取优惠券</a>
                    </div>
                </div>
                <ul>
                    <li>
                        <div class="items">
                            <div class="check-wrapper">
                                <span class="cart-checkbox prod-checked"></span>
                            </div>
                            <div class="shop-cart-item-core clearfix">
                                <a href="#">
                                   <img> 
                                </a>
                                <div class="cart-product-cell">
                                    <div class="cart-product-name">
                                        <a href="#">
                                            <span class="title">八马茶业 铁观音茶叶 清香特级 安溪乌龙茶 安溪铁观音 礼盒 250g</span>
                                        </a>
                                    </div>
                                    <div class="cart-product-cell-1">
                                        <span class="shp-cart-item-price">¥17.00</span>
                                        <div class="quantity-wrapper">
                                            <a href="#" class="quantity-decrease">-</a>
                                            <input type="tel" size="4" value="1" name="num" class="quantity">
                                            <a href="#" class="quantity-increase">+</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="del-box"><span>删除</span></div>
                        </div>
                    </li>
                    <li>
                        <div class="items">
                            <div class="check-wrapper">
                                <span class="cart-checkbox prod-checked"></span>
                            </div>
                            <div class="shop-cart-item-core clearfix">
                                <a href="#">
                                   <img> 
                                </a>
                                <div class="cart-product-cell">
                                    <div class="cart-product-name">
                                        <a href="#">
                                            <span class="title">八马茶业 铁观音茶叶 清香特级 安溪乌龙茶 安溪铁观音 礼盒 250g</span>
                                        </a>
                                    </div>
                                    <div class="cart-product-cell-1">
                                        <span class="shp-cart-item-price">¥18.00</span>
                                        <div class="quantity-wrapper">
                                            <a href="#" class="quantity-decrease">-</a>
                                            <input type="tel" size="4" value="1" name="num" class="quantity">
                                            <a href="#" class="quantity-increase">+</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="del-box"><span>删除</span></div>
                        </div>
                    </li>
                    <li>
                        <div class="items">
                            <div class="check-wrapper">
                                <span class="state">下架</span>
                            </div>
                            <div class="shop-cart-item-core clearfix">
                                <a href="#">
                                   <img> 
                                </a>
                                <div class="cart-product-cell">
                                    <div class="cart-product-name">
                                        <a href="#">
                                            <span class="title">八马茶业 铁观音茶叶 清香特级 安溪乌龙茶 安溪铁观音 礼盒 250g</span>
                                        </a>
                                    </div>
                                    <div class="cart-product-cell-1">
                                        <span class="shp-cart-item-price">¥19.00</span>
                                        <div class="quantity-wrapper">
                                            <a href="#" class="quantity-decrease">-</a>
                                            <input type="tel" size="4" value="1" name="num" class="quantity">
                                            <a href="#" class="quantity-increase">+</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="del-box"><span>删除</span></div>
                        </div>
                    </li>
                    <li>
                        <div class="items">
                            <div class="check-wrapper">
                                <span class="state">缺货</span>
                            </div>
                            <div class="shop-cart-item-core clearfix">
                                <a href="#">
                                   <img> 
                                </a>
                                <div class="cart-product-cell">
                                    <div class="cart-product-name">
                                        <a href="#">
                                            <span class="title">八马茶业 铁观音茶叶 清香特级 安溪乌龙茶 安溪铁观音 礼盒 250g</span>
                                        </a>
                                    </div>
                                    <div class="cart-product-cell-1">
                                        <span class="shp-cart-item-price">¥11.00</span>
                                        <div class="quantity-wrapper">
                                            <a href="#" class="quantity-decrease">-</a>
                                            <input type="tel" size="4" value="1" name="num" class="quantity">
                                            <a href="#" class="quantity-increase">+</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="del-box"><span>删除</span></div>
                        </div>
                    </li>
                </ul>
            </div>
            
        </div>
    </div>
    <div class="cart-footer">
        <div class="container">
            <div class="cart-handle clearfix">
                <div class="checkbox-all">
                    <div class="check-wrapper">
                        <span class="cart-checkbox all-checked"></span>
                    </div>
                    <span class="txt">全选</span>
                </div>
                <div class="cart-group">
                    <span class="sum">合计：<span id="allMoney">¥0.00</span></span>
                    <a href="#" class="btn">下单</a>
                </div>
            </div>
        </div>
    </div>
    <div class="bottom-tab clearfix" id="tab2">
        <a class="tab-b-item" href="#">
            <span class="tb-icon i-tb-home"></span>
            <p class="tabbar-label">首页</p>
        </a>
        <a class="tab-b-item tab-b-active" href="javascript:void(0)">
            <span class="tb-icon i-tb-sort"></span>
            <p class="tabbar-label">分类</p>
        </a>
        <a class="tab-b-item" href="#">
        <span class="tb-icon i-tb-cart"></span>
            <p class="tabbar-label">购物车</p>
        </a>
        <a class="tab-b-item" href="#">
            <span class="tb-icon i-tb-my"></span>
            <p class="tabbar-label">我的</p>
        </a>
    </div>
    <script type="text/javascript" src="./js/zepto.min.js"></script>
    <script type="text/javascript" src="./js/plugins/layer/layer.js"></script>
    <script>
    $('body').addClass('page-bg');

    /*选中商品*/
    $('.prod-checked').on('click', function(){
        var price = ($(this).parent().next().find('.shp-cart-item-price').text()).slice(1);
        var numOnly = $(this).parent().next().find('.quantity').val(); 
        var ownNum = price * numOnly;
        var allMiCON = parseInt($('#allMoney').text().slice(1));
        if($(this).hasClass('checked') == true) { 
            $(this).removeClass('checked');  
            $(this).closest('ul').prev().find('.shop-checked').removeClass('checked');
            $('.all-checked').removeClass('checked');
            $('#allMoney').text("¥" + (allMiCON - ownNum).toFixed(2));
        }else {
            $(this).addClass('checked');
            var sibAll = $(this).closest('li').siblings().find('.prod-checked');
            if(sibAll.hasClass('checked') == true) {
                $(this).closest('ul').prev().find('.shop-checked').addClass('checked');
            }
            $('#allMoney').text("¥" + (allMiCON + ownNum).toFixed(2));
        }           
    });

    /*选中店铺*/
    $('.shop-checked').on('click', function(){  
        var checkCart = $(this).parents('.shop-title').next('ul').find('.prod-checked');
        var allAllMo = 0;
        var allAllMoOth = 0;  //未选中的值
        var allMiCON = parseInt($('#allMoney').text().slice(1));
        for(i=0;i<checkCart.length;i++) {
            var ownOnlyMO = $(checkCart[i]).parent().next().find('.shp-cart-item-price').text().slice(1);
            var ownOnlyNum = $(checkCart[i]).parent().next().find('.quantity').val();
            var ownAddSub = ownOnlyMO * ownOnlyNum;
            allAllMo += ownAddSub;
            if($(checkCart[i]).hasClass('checked') == false) {
                var ownAddSubOth = ownOnlyMO * ownOnlyNum;
                allAllMoOth += ownAddSubOth;
            }
        }
        if($(this).hasClass('checked') == true) {
            $(this).removeClass('checked');
            checkCart.removeClass('checked');
            $('#allMoney').text("¥" + (allMiCON - allAllMo).toFixed(2));
        }else {
            $(this).addClass('checked');
            checkCart.addClass('checked'); 
            $('#allMoney').text("¥" + (allMiCON + allAllMoOth).toFixed(2));
        }
    });

    /*全选*/
    $('.all-checked').on('click', function() {
        if($(this).hasClass('checked') == true) { 
            $(this).removeClass('checked');
            $('.shop-group-item .cart-checkbox').removeClass('checked');
            $('#allMoney').text('¥0.00');
        }else { 
            $(this).addClass('checked');
            $('.shop-group-item .cart-checkbox').addClass('checked');
            var checkCart = $('.prod-checked');
            var allAllMo = 0;
            for(i=0;i<checkCart.length;i++) {
                var ownOnlyMO = $(checkCart[i]).parent().next().find('.shp-cart-item-price').text().slice(1);
                var ownOnlyNum = $(checkCart[i]).parent().next().find('.quantity').val();
                var ownAddSub = ownOnlyMO * ownOnlyNum;
                allAllMo += ownAddSub;
            }
            $('#allMoney').text("¥" + allAllMo.toFixed(2));
        }           
    });

    /*加减法*/
    $('.quantity-decrease').click(function () {
        var obj = $(this).siblings('.quantity');
        var num = parseInt(obj.val());
        if (num <= 1) {
            return false;
        }
        obj.val(parseInt(obj.val()) - 1);
        var checkHas = $(this).closest('.shop-cart-item-core').prev().children('.prod-checked');
        var priceSpan = $(this).parent().prev().text().slice(1); 
        var allMiCON = parseInt($('#allMoney').text().slice(1));
        if(checkHas.hasClass('checked') == true) {                  
            $('#allMoney').text("¥" + (parseInt(allMiCON) - parseInt(priceSpan)).toFixed(2));
        }
    });
    $('.quantity-increase').click(function () {
        var obj = $(this).siblings('.quantity');
        obj.val(parseInt(obj.val()) + 1);
        var checkHas = $(this).closest('.shop-cart-item-core').prev().children('.prod-checked');
        var priceSpan = $(this).parent().prev().text().slice(1); 
        var allMiCON = parseInt($('#allMoney').text().slice(1));
        if(checkHas.hasClass('checked') == true) {
            $('#allMoney').text("¥" + (parseInt(allMiCON) + parseInt(priceSpan)).toFixed(2));
        }
    });
        
     // 领取优惠券
    $('.get-coupons').click(function () {
        var content = ''
        + '<div class="coupons-box">'
            + '<span class="close icon icon-95" onclick="layer.closeAll();"></span>'
            + '<h4>领取优惠券</h4>'
            + '<ul>'
                + '<a href="#"><li>'
                    + '<div class="coupons-bd">'
                        + '<div class="coupons-num">'
                            + '<span class="yuan">¥ </span><span class="num">30</span>'
                        + '</div>'
                        + '<div class="coupons-desc">'
                            + '<p>峨眉雪芽官方旗舰店部分可用满199元可用</p>'
                            + '<p class="txt">满199元可用</p>'
                        + '</div>'
                    + '</div>'
                    + '<p class="coupons-ft">有效期：2017.02.01-2017.13.31</p>'
                    + '<span class="done"></span>'
                + '</li></a>'
                + '<a href="#"><li class="out-date">'
                    + '<div class="coupons-bd">'
                        + '<div class="coupons-num">'
                            + '<span class="yuan">¥ </span><span class="num">30</span>'
                        + '</div>'
                        + '<div class="coupons-desc">'
                            + '<p>峨眉雪芽官方旗舰店部分可用满199元可用</p>'
                            + '<p class="txt">满199元可用</p>'
                        + '</div>'
                    + '</div>'
                    + '<p class="coupons-ft">有效期：2017.02.01-2017.13.31</p>'
                    + '<span class="done"></span>'
                + '</li></a>'
                + '<a href="#"><li>'
                    + '<div class="coupons-bd">'
                        + '<div class="coupons-num">'
                            + '<span class="yuan">¥ </span><span class="num">30</span>'
                        + '</div>'
                        + '<div class="coupons-desc">'
                            + '<p>峨眉雪芽官方旗舰店部分可用满199元可用</p>'
                            + '<p class="txt">满199元可用</p>'
                        + '</div>'
                    + '</div>'
                    + '<p class="coupons-ft">有效期：2017.02.01-2017.13.31</p>'
                + '</li></a>'
            + '</ul>'
        + '</div>';
        layer.open({
            type: 1
            ,content: content
            ,anim: 'up'
            ,style: 'position:fixed; bottom:0; left:0; width: 100%; height: 280px; padding:10px 0; border:none; overflow-y: scroll;'
        });
    });
    $('.shop-group').on('swipeLeft', '.items', function(){
        $('.shop-group .items').css('transform', 'translate3d(0px, 0px, 0px)');
        $(this).css('transform', 'translate3d(-60px, 0px, 0px)');
    });
    $('.shop-group').on('swipeRight', '.items', function(){
        $(this).css('transform', 'translate3d(0px, 0px, 0px)');
    });
    </script>
</body>
</html>
